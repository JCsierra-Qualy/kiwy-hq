# Progress Log
Run: 4853a77d-9e72-442e-a85d-ca7159673fec
Task: Kiwy HQ MVP v1
Started: 2026-02-15T17:07:00Z

## Codebase Patterns
- Express app factory is `createApp()` in `src/server.ts`; tests import it and spin up an ephemeral port via `app.listen(0)`.
- Tests use `node:test` with the built-in `http` client (no supertest) and run via `node --import tsx --test`.
- Route protection is implemented via an `app.use()` middleware that redirects to `/login` when `kiwy_hq_auth` cookie is missing.
- HTML pages are rendered via a small string-template helper (`renderLayout`) in `src/server.ts` to keep a consistent UI shell.

---

## 2026-02-15 - US-001: Auth: token login page + httpOnly cookie session
- Added `/login` (GET HTML form + POST token validation against `KIWY_HQ_TOKEN`) and `/logout` (POST clears cookie).
- Cookie session is stored in an httpOnly cookie (`kiwy_hq_auth`) with `SameSite=Lax`.
- Added auth flow tests for login/logout.
- Files changed: `src/server.ts`, `test/auth.test.ts`
- **Learnings:** Keep request parsing enabled via `express.urlencoded()` for simple HTML form posts.
---

## 2026-02-15 - US-002: Auth: protect routes with middleware
- Added `authRequiredMiddleware` to protect all routes except `/health` and `/login`; unauthenticated users are redirected to `/login`.
- Added placeholder `/secrets` route (protected by middleware).
- Updated logout test to include auth cookie.
- Files changed: `src/server.ts`, `test/auth.test.ts`
- **Learnings:** When using express + cookie-parser, `req.path` is a simple way to match public routes inside global auth middleware.
---

## 2026-02-15 - US-003: UI shell: Kiwy-themed layout + navigation
- Implemented a Kiwy-themed HTML shell (header + nav + footer) shared by `/` and `/secrets`.
- Dashboard now shows basic grouped cards for Qualiver / ECHO / Kuenti / Personal with placeholder links.
- Secrets page shows non-functional, disabled password inputs and explicitly does not render any stored values.
- Added tests asserting the shared shell renders on both routes, nav links work/mark active, and secrets page contains no non-empty `value="..."`.
- Files changed: `src/server.ts`, `test/ui-shell.test.ts`
- **Learnings:** Add `aria-current="page"` to the active nav link to simplify HTML assertions in tests.
---
